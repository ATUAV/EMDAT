<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>BasicParticipant_multiprocessing API documentation</title>
    <meta name="description" content="UBC Eye Movement Data Analysis Toolkit (EMDAT), Version 3
Created on 2014-09-16

Sample code showing..." />

  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>


  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">

    <li class="set"><h3><a href="#header-functions">Functions</a></h3>
      
  <ul>
    <li class="mono"><a href="#BasicParticipant_multiprocessing.chunks">chunks</a></li>
    <li class="mono"><a href="#BasicParticipant_multiprocessing.export_pupil_dilation_from_scene">export_pupil_dilation_from_scene</a></li>
    <li class="mono"><a href="#BasicParticipant_multiprocessing.list_to_string">list_to_string</a></li>
    <li class="mono"><a href="#BasicParticipant_multiprocessing.partition_Basic">partition_Basic</a></li>
    <li class="mono"><a href="#BasicParticipant_multiprocessing.plot_pupil_dilation_all">plot_pupil_dilation_all</a></li>
    <li class="mono"><a href="#BasicParticipant_multiprocessing.read_events">read_events</a></li>
    <li class="mono"><a href="#BasicParticipant_multiprocessing.read_participants_Basic">read_participants_Basic</a></li>
    <li class="mono"><a href="#BasicParticipant_multiprocessing.read_participants_Basic_multiprocessing">read_participants_Basic_multiprocessing</a></li>
    <li class="mono"><a href="#BasicParticipant_multiprocessing.read_rest_pupil_sizes">read_rest_pupil_sizes</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#BasicParticipant_multiprocessing.BasicParticipant">BasicParticipant</a></span>
        
          
  <ul>
    <li class="mono"><a href="#BasicParticipant_multiprocessing.BasicParticipant.__init__">__init__</a></li>
    <li class="mono"><a href="#BasicParticipant_multiprocessing.BasicParticipant.export_features">export_features</a></li>
    <li class="mono"><a href="#BasicParticipant_multiprocessing.BasicParticipant.export_features_tsv">export_features_tsv</a></li>
    <li class="mono"><a href="#BasicParticipant_multiprocessing.BasicParticipant.invalid_segments">invalid_segments</a></li>
    <li class="mono"><a href="#BasicParticipant_multiprocessing.BasicParticipant.is_valid">is_valid</a></li>
    <li class="mono"><a href="#BasicParticipant_multiprocessing.BasicParticipant.print_">print_</a></li>
    <li class="mono"><a href="#BasicParticipant_multiprocessing.BasicParticipant.valid_segments">valid_segments</a></li>
    <li class="mono"><a href="#BasicParticipant_multiprocessing.BasicParticipant.write_raw_data">write_raw_data</a></li>
  </ul>

        </li>
      </ul>
    </li>

    <li class="set"><h3><a href="#header-submodules">Sub-modules</a></h3>
      <ul>
        <li class="mono"><a href="params.m.html">BasicParticipant_multiprocessing.params</a></li>
      </ul>
    </li>
    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">BasicParticipant_multiprocessing</span> module</h1>
  <p>UBC Eye Movement Data Analysis Toolkit (EMDAT), Version 3
Created on 2014-09-16</p>
<p>Sample code showing how to instantiate the "Participant" class for a given experiment (multiprocessing version).</p>
<p>Authors: Sebastien Lalle (creator), Samad Kardan.
Institution: The University of British Columbia.</p>
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-BasicParticipant_multiprocessing', this);">Show source &equiv;</a></p>
  <div id="source-BasicParticipant_multiprocessing" class="source">
    <pre><code>"""
UBC Eye Movement Data Analysis Toolkit (EMDAT), Version 3
Created on 2014-09-16

Sample code showing how to instantiate the "Participant" class for a given experiment (multiprocessing version).

Authors: Sebastien Lalle (creator), Samad Kardan.
Institution: The University of British Columbia.
"""
import sys
sys.path.append('.')
sys.path.append('./EMDAT_core')
from math import ceil, floor
from multiprocessing import Process, Queue
import os.path

params = __import__('params')
from EMDAT_core.data_structures import *
from EMDAT_core.Participant import *
from EMDAT_core.Recording import *
from EMDAT_core.AOI import AOI
from EMDAT_core.Scene import Scene
from EMDAT_core.utils import *

from EMDAT_eyetracker.TobiiV2Recording import TobiiV2Recording
from EMDAT_eyetracker.TobiiV3Recording import TobiiV3Recording
from EMDAT_eyetracker.SMIRecording import SMIRecording


class BasicParticipant(Participant):
    """
    This is a sample child class based on the Participant class that implements all the
    placeholder methods in the Participant class for a basic project
    """
    def __init__(self, pid, eventfile, datafile, fixfile, saccfile, segfile, log_time_offset = None, aoifile = None, prune_length= None,
                 require_valid_segs = True, auto_partition_low_quality_segments = False, rpsdata = None, export_pupilinfo = False):
        """Inits BasicParticipant class
        Args:
            pid: Participant id

            eventfile: a string containing the name of the "Event-Data.tsv" file for this participant

            datafile: a string containing the name of the "All-Data.tsv" file for this participant

            fixfile: a string containing the name of the "Fixation-Data.tsv" file for this participant

            segfile: a string containing the name of the '.seg' file for this participant

            log_time_offset: If not None, an integer indicating the time offset between the
                external log file and eye tracking logs

            aoifile: If not None, a string containing the name of the '.aoi' file
                with definitions of the "AOI"s.

            prune_length: If not None, an integer that specifies the time
                interval (in ms) from the beginning of each Segment in which
                samples are considered in calculations.  This can be used if,
                for example, you only wish to consider data in the first
                1000 ms of each Segment. In this case (prune_length = 1000),
                all data beyond the first 1000ms of the start of the "Segment"s
                will be disregarded.

            auto_partition_low_quality_segments: a boolean indicating whether EMDAT should
                split the "Segment"s which have low sample quality, into two new
                sub "Segment"s discarding the largest gap of invalid samples.

            rpsdata: rest pupil sizes for all scenes if available

        Yields:
            a BasicParticipant object
        """


        Participant.__init__(self, pid, eventfile, datafile, fixfile, saccfile, segfile, log_time_offset, aoifile, prune_length,
                 require_valid_segs, auto_partition_low_quality_segments, rpsdata)   #calling the Participant's constructor

        print "Participant \""+str(pid)+"\"..."
        if params.VERBOSE != "QUIET":
            print "Reading input files:"
            print "--Scenes/Segments file: "+segfile
            print "--Eye tracking samples file: "+datafile
            print "--Fixations file: "+fixfile
            print "--Saccades file: "+saccfile if saccfile is not None else "--No saccades file"
            print "--Events file: "+eventfile if eventfile is not None else "--No events file"
            print "--AOIs file: "+aoifile if aoifile is not None else "--No AOIs file"
            print

        self.features={}
        if params.EYETRACKERTYPE == "TobiiV2":
            rec = TobiiV2Recording(datafile, fixfile, event_file=eventfile, media_offset=params.MEDIA_OFFSET)
        elif params.EYETRACKERTYPE == "TobiiV3":
            rec = TobiiV3Recording(datafile, fixfile, saccade_file=saccfile, event_file=eventfile, media_offset=params.MEDIA_OFFSET)
        elif params.EYETRACKERTYPE == "SMI":
            rec = SMIRecording(datafile, fixfile, saccade_file=saccfile, event_file=eventfile, media_offset=params.MEDIA_OFFSET)
        else:
            raise Exception("Unknown eye tracker type.")

        if params.VERBOSE != "QUIET":
            print "Creating partition..."

        scenelist,self.numofsegments = partition(segfile)
        if self.numofsegments == 0:
            raise Exception("No segments found.")

        if aoifile is not None:
            aois = read_aois(aoifile)
        else:
            aois = None

        self.features['numofsegments'] = self.numofsegments

        if params.VERBOSE != "QUIET":
            print "Generating features..."

        self.segments, self.scenes = rec.process_rec(scenelist = scenelist,aoilist = aois,prune_length = prune_length, require_valid_segs = require_valid_segs,
                                                     auto_partition_low_quality_segments = auto_partition_low_quality_segments, rpsdata = rpsdata, export_pupilinfo=export_pupilinfo)

        all_segs = sorted(self.segments, key=lambda x: x.start)
        self.whole_scene = Scene(str(pid)+'_allsc',[],rec.all_data,rec.fix_data, saccade_data = rec.sac_data, event_data = rec.event_data, Segments = all_segs, aoilist = aois,prune_length = prune_length, require_valid = require_valid_segs, export_pupilinfo=export_pupilinfo )
        self.scenes.insert(0,self.whole_scene)

        #Clean memory
        for sc in self.scenes:
            sc.clean_memory()
        rec.clean_memory()

        if params.VERBOSE != "QUIET":
            print "Done!"


def read_participants_Basic(q, datadir, user_list, pids, prune_length = None, aoifile = None, log_time_offsets=None,
                          require_valid_segs = True, auto_partition_low_quality_segments = False, rpsfile = None, export_pupilinfo = False):
    """Generates list of Participant objects. Relevant information is read from input files

    Args:
        q: Queue to which all processes must add return values.

        datadir: directory with user data (including "All-Data.tsv", "Fixation-Data.tsv", "Event-Data.tsv" files)
        for all participants

        user_list: list of user recordings (files extracted for one participant from Tobii studio)

        pids: User ID that is used in the external logs (can be different from above but there should be a 1-1 mapping)

        prune_length: If not None, an integer that specifies the time
            interval (in ms) from the beginning of each Segment in which
            samples are considered in calculations.  This can be used if,
            for example, you only wish to consider data in the first
            1000 ms of each Segment. In this case (prune_length = 1000),
            all data beyond the first 1000ms of the start of the "Segment"s
            will be disregarded.

        aoifile: If not None, a string containing the name of the '.aoi' file
            with definitions of the "AOI"s.

        log_time_offset: If not None, an integer indicating the time offset between the
            external log file and eye tracking logs

        require_valid_segs: a boolean determining whether invalid "Segment"s
            will be ignored when calculating the features or not. default = True

        auto_partition_low_quality_segments: a boolean indicating whether EMDAT should
            split the "Segment"s which have low sample quality, into two new
            sub "Segment"s discarding the largest gap of invalid samples.

        rpsfile: If not None, a string containing the name of the '.tsv' file
            with rest pupil sizes for all scenes and for each user.

    Returns:
        a list Participant objects (in queue)
    """
    participants = []
    if log_time_offsets == None:    #setting the default offset which is 1 sec
        log_time_offsets = [0]*len(pids)

    # read rest pupil sizes (rpsvalues) from rpsfile
    rpsdata = read_rest_pupil_sizes(rpsfile)

    for rec,pid,offset in zip(user_list,pids,log_time_offsets):
        #extract pupil sizes for the current user. Set to None if not available
        if rpsdata != None:
            currpsdata = rpsdata[pid]
        else:
            currpsdata = None

        if params.EYETRACKERTYPE == "TobiiV2":
            allfile = datadir+'/TobiiV2/P'+str(rec)+'-All-Data.tsv'
            fixfile = datadir+'/TobiiV2/P'+str(rec)+'-Fixation-Data.tsv'
            evefile = datadir+'/TobiiV2/P'+str(rec)+'-Event-Data.tsv'
            sacfile = None
            segfile = datadir+'/TobiiV2/P'+str(rec)+'.seg'
        elif params.EYETRACKERTYPE == "TobiiV3":
            allfile = "{dir}/TobiiV3/P{rec}_Data_Export.tsv".format(dir=datadir, rec=rec)
            fixfile = "{dir}/TobiiV3/P{rec}_Data_Export.tsv".format(dir=datadir, rec=rec)
            sacfile = "{dir}/TobiiV3/P{rec}_Data_Export.tsv".format(dir=datadir, rec=rec)
            evefile = "{dir}/TobiiV3/P{rec}_Data_Export.tsv".format(dir=datadir, rec=rec)
            segfile = "{dir}/TobiiV3/TobiiV3_sample_{rec}.seg".format(dir=datadir, rec=rec)
            #aoifile = "{dir}/TobiiV3/TobiiV3_sample_{rec}.aoi".format(dir=datadir, rec=rec)
        elif params.EYETRACKERTYPE == "SMI":
            allfile = "{dir}/SMI/SMI_Sample_{rec}_Samples.txt".format(dir=datadir, rec=rec)
            fixfile = "{dir}/SMI/SMI_Sample_{rec}_Events.txt".format(dir=datadir, rec=rec)
            sacfile = "{dir}/SMI/SMI_Sample_{rec}_Events.txt".format(dir=datadir, rec=rec)
            evefile = "{dir}/SMI/SMI_Sample_{rec}_Events.txt".format(dir=datadir, rec=rec)
            segfile = "{dir}/SMI/SMI_Sample_{rec}.seg".format(dir=datadir, rec=rec)

        if os.path.exists(allfile):
            p = BasicParticipant(rec, evefile, allfile, fixfile, sacfile, segfile, log_time_offset = offset,
                                aoifile=aoifile, prune_length = prune_length, require_valid_segs = require_valid_segs,
                                auto_partition_low_quality_segments = auto_partition_low_quality_segments, rpsdata = currpsdata)
            participants.append(p)
        else:
            print "Error reading participant files for: "+str(pid)
    q.put(participants)
    return

def read_participants_Basic_multiprocessing(nbprocesses, datadir, user_list, pids, prune_length = None, aoifile = None, log_time_offsets = None,
                          require_valid_segs = True, auto_partition_low_quality_segments = False, rpsfile = None, export_pupilinfo = False):
    """Generates list of Participant objects in parallel computing. Relevant information is read from input files

    Args:
        nbprocesses: number of processes to run in parallel (number of CPU cores is a good option).

        datadir: directory with user data (including "All-Data.tsv", "Fixation-Data.tsv", "Event-Data.tsv" files)
        for all participants

        user_list: list of user recordings (files extracted for one participant from Tobii studio)

        pids: User ID that is used in the external logs (can be different from above but there should be a 1-1 mapping)

        prune_length: If not None, an integer that specifies the time
            interval (in ms) from the beginning of each Segment in which
            samples are considered in calculations.  This can be used if,
            for example, you only wish to consider data in the first
            1000 ms of each Segment. In this case (prune_length = 1000),
            all data beyond the first 1000ms of the start of the "Segment"s
            will be disregarded.

        aoifile: If not None, a string containing the name of the '.aoi' file
            with definitions of the "AOI"s.

        log_time_offset: If not None, an integer indicating the time offset between the
            external log file and eye tracking logs

        require_valid_segs: a boolean determining whether invalid "Segment"s
            will be ignored when calculating the features or not. default = True

        auto_partition_low_quality_segments: a boolean indicating whether EMDAT should
            split the "Segment"s which have low sample quality, into two new
            sub "Segment"s discarding the largest gap of invalid samples.

        rpsfile: If not None, a string containing the name of the '.tsv' file
            with rest pupil sizes for all scenes and for each user.

    Returns:
        a list Participant objects
    """

    q = Queue()
    listprocess = []
    participants = []

    if nbprocesses < 1:
        nbprocesses = 1
    if nbprocesses > len(user_list):
        nbprocesses = len(user_list)

    for i in range(0, nbprocesses): #create a sublist of participants for each process
        user_listsplit = chunks(user_list, nbprocesses)
        pidssplit = chunks(pids, nbprocesses)
        log_time_offsets_list = chunks(log_time_offsets, nbprocesses) if log_time_offsets is not None else None

    print user_listsplit
    try:
        for i in range(0, nbprocesses):
            if log_time_offsets is None:
			    p = Process(target=read_participants_Basic, args=(q, datadir, user_listsplit[i], pidssplit[i], prune_length, aoifile, log_time_offsets,
                          require_valid_segs, auto_partition_low_quality_segments, rpsfile, export_pupilinfo))
            else:
			    p = Process(target=read_participants_Basic, args=(q, datadir, user_listsplit[i], pidssplit[i], prune_length, aoifile, log_time_offsets_list[i],
                          require_valid_segs, auto_partition_low_quality_segments, rpsfile, export_pupilinfo))

            listprocess.append(p)
            p.start() # start the process

        for i in range(0, nbprocesses):
            participants = participants + q.get(True) # wait for the results of all processes

        for pr in listprocess:
            pr.terminate()
            pr.join() #kill the process

    except  Exception as e:
        exc_type, exc_obj, exc_tb = sys.exc_info()
        print "Exception", sys.exc_info()
        print "Line ", exc_tb.tb_lineno

    return participants

def chunks(l, n):
    """Split a list in balanced sub-lists. If equal sublits are not possible, remaining elements are distribute evenly among sublists.

    Args:
        l: the list to split.

        n: the number of sublists to generate.

    Returns:
        a list of n sublists
    """
    if n < 1:
        n = 1
    if len(l) < n:
        n = len(l)

    nsize = len(l)/n #number of elements in the sublists
    if len(l)%n == 0:
        return [l[i:i + nsize] for i in range(0, len(l), nsize)]
    else:
        l2 = [l[i:i + nsize] for i in range(0, len(l[0:nsize*n]), nsize)]
        i=0
        for j in l[nsize*n:len(l)]: #distribute remaining elements
            l2[i].append(j)
            i = (i+1) % n
        return l2

def partition_Basic(segfile):
    """Generates the scenelist based on a .seg file

    Args:
        segfile: a string containing the name of the '.seg' file

    Returns:
        a dict with scid as the key and tuples of (segid, start , end) for segments that belong to
            that scene as value
        an integer determining the number of segments
    """
    scenelist = read_segs(segfile)
    segcount = 0
    for l in scenelist.itervalues():
        segcount += len(l)
    return scenelist, segcount



def read_events(evfile):
    """Returns a list of Event objects read from an 'Event-Data.tsv' file.

    Args:
        evfile: a string containing the name of the 'Event-Data.tsv' file exported by
            Tobii software

    Returns:
        a list of Event objects
    """
    with open(evfile, 'r') as f:
        lines = f.readlines()

    return map(Event, lines[(params.EVENTSHEADERLINES+params.NUMBEROFEXTRAHEADERLINES):])

def read_rest_pupil_sizes(rpsfile):
    """
    Returns a dictionary of rest pupil sizes for all scenes if rpsfile is provided. None otherwise
    The input file has the following format:
        pid\t<scene name 1>\t<scene name 2>....\n
        <pid 1>\t<rest pupil size 1>\t<rest pupil size 2>

    Args:
        rpsfile: a string containing the name of the '.tsv' file
            with rest pupil sizes for all partiicpants and all scenes.

    Returns:
        a dictionary of rest pupil sizes. None otherwise

    """
    if rpsfile != None:
        with open(rpsfile, 'r') as f:
            lines = f.readlines()
        rpsdic = {}
        import re
        scenelist = re.findall('\w+', lines[0])
        for line in lines[1:]:
            linelist = re.findall('\w+', line)
            pid = cast_int(linelist[0])
            if pid == None: #if casting didn't work
                pid = linelist[0]
            rpsdic[pid] = {}
            for scene, rpsvalue in zip(scenelist[1:], linelist[1:]):
                rpsdic[pid][scene] = cast_int(rpsvalue)

        return rpsdic
    else:
        return None



def plot_pupil_dilation_all(participants, outdir, scene):
    """
    Plots adjusted pupil dilations to

    Args:
        participants: collection of Participant objects

        outdir: directory where files should be exported

        scene: name of scene to be exported

    Returns:

    """
    lines = []
    for participant in participants:
        lines = export_pupil_dilation_from_scene(participant, scene, separator = "\t")
        with open(outdir + "pupildata" + "_" + str(participant.pid) + "_" + str(scene) + ".tsv", "w") as fout:
            if lines is not None:
                for line in lines:
                    fout.write(line)
            else:
                fout.write("There is no scene " + str(scene) + " in the participant " + str(participant.pid) + " record ")


def export_pupil_dilation_from_scene(participant, scene, separator = "\t"):
    """
    Exports pupil dilation information from  pupilinfo_for_export for a scene of a participant

    Args:
        participant: a Participant object

        scene: name of scene to be exported

    Returns:
        a collection of lines to be written in the file
    """
    lines = []
    for sc in participant.scenes:
        if sc.scid == scene:
            lines.append("timestamp\tpupil size\tadjusted pupil size\n")
            for el in sc.pupilinfo_for_export:
                lines.append(list_to_string(el, "\t"))
            return lines

    return None

def list_to_string(list, separator = "\t"):
    """
    Converts a list of values to a string using SEPARATOR for joints

    Args:
        list: a list of values to be converted to a string

        separator:  a separator to be used for joints

    Returns:
        a string

    """
    return separator.join(map(str, list))+ "\n"
</code></pre>
  </div>

  </header>

  <section id="section-items">

    <h2 class="section-title" id="header-functions">Functions</h2>
      
  <div class="item">
    <div class="name def" id="BasicParticipant_multiprocessing.chunks">
    <p>def <span class="ident">chunks</span>(</p><p>l, n)</p>
    </div>
    

    
  
    <div class="desc"><p>Split a list in balanced sub-lists. If equal sublits are not possible, remaining elements are distribute evenly among sublists.</p>
<p>Args:
    l: the list to split.</p>
<pre><code>n: the number of sublists to generate.
</code></pre>
<p>Returns:
    a list of n sublists</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-BasicParticipant_multiprocessing.chunks', this);">Show source &equiv;</a></p>
  <div id="source-BasicParticipant_multiprocessing.chunks" class="source">
    <pre><code>def chunks(l, n):
    """Split a list in balanced sub-lists. If equal sublits are not possible, remaining elements are distribute evenly among sublists.

    Args:
        l: the list to split.

        n: the number of sublists to generate.

    Returns:
        a list of n sublists
    """
    if n < 1:
        n = 1
    if len(l) < n:
        n = len(l)

    nsize = len(l)/n #number of elements in the sublists
    if len(l)%n == 0:
        return [l[i:i + nsize] for i in range(0, len(l), nsize)]
    else:
        l2 = [l[i:i + nsize] for i in range(0, len(l[0:nsize*n]), nsize)]
        i=0
        for j in l[nsize*n:len(l)]: #distribute remaining elements
            l2[i].append(j)
            i = (i+1) % n
        return l2
</code></pre>
  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="BasicParticipant_multiprocessing.export_pupil_dilation_from_scene">
    <p>def <span class="ident">export_pupil_dilation_from_scene</span>(</p><p>participant, scene, separator=&#39;\t&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Exports pupil dilation information from  pupilinfo_for_export for a scene of a participant</p>
<p>Args:
    participant: a Participant object</p>
<pre><code>scene: name of scene to be exported
</code></pre>
<p>Returns:
    a collection of lines to be written in the file</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-BasicParticipant_multiprocessing.export_pupil_dilation_from_scene', this);">Show source &equiv;</a></p>
  <div id="source-BasicParticipant_multiprocessing.export_pupil_dilation_from_scene" class="source">
    <pre><code>def export_pupil_dilation_from_scene(participant, scene, separator = "\t"):
    """
    Exports pupil dilation information from  pupilinfo_for_export for a scene of a participant

    Args:
        participant: a Participant object

        scene: name of scene to be exported

    Returns:
        a collection of lines to be written in the file
    """
    lines = []
    for sc in participant.scenes:
        if sc.scid == scene:
            lines.append("timestamp\tpupil size\tadjusted pupil size\n")
            for el in sc.pupilinfo_for_export:
                lines.append(list_to_string(el, "\t"))
            return lines

    return None
</code></pre>
  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="BasicParticipant_multiprocessing.list_to_string">
    <p>def <span class="ident">list_to_string</span>(</p><p>list, separator=&#39;\t&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Converts a list of values to a string using SEPARATOR for joints</p>
<p>Args:
    list: a list of values to be converted to a string</p>
<pre><code>separator:  a separator to be used for joints
</code></pre>
<p>Returns:
    a string</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-BasicParticipant_multiprocessing.list_to_string', this);">Show source &equiv;</a></p>
  <div id="source-BasicParticipant_multiprocessing.list_to_string" class="source">
    <pre><code>def list_to_string(list, separator = "\t"):
    """
    Converts a list of values to a string using SEPARATOR for joints

    Args:
        list: a list of values to be converted to a string

        separator:  a separator to be used for joints

    Returns:
        a string

    """
    return separator.join(map(str, list))+ "\n"
</code></pre>
  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="BasicParticipant_multiprocessing.partition_Basic">
    <p>def <span class="ident">partition_Basic</span>(</p><p>segfile)</p>
    </div>
    

    
  
    <div class="desc"><p>Generates the scenelist based on a .seg file</p>
<p>Args:
    segfile: a string containing the name of the '.seg' file</p>
<p>Returns:
    a dict with scid as the key and tuples of (segid, start , end) for segments that belong to
        that scene as value
    an integer determining the number of segments</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-BasicParticipant_multiprocessing.partition_Basic', this);">Show source &equiv;</a></p>
  <div id="source-BasicParticipant_multiprocessing.partition_Basic" class="source">
    <pre><code>def partition_Basic(segfile):
    """Generates the scenelist based on a .seg file

    Args:
        segfile: a string containing the name of the '.seg' file

    Returns:
        a dict with scid as the key and tuples of (segid, start , end) for segments that belong to
            that scene as value
        an integer determining the number of segments
    """
    scenelist = read_segs(segfile)
    segcount = 0
    for l in scenelist.itervalues():
        segcount += len(l)
    return scenelist, segcount
</code></pre>
  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="BasicParticipant_multiprocessing.plot_pupil_dilation_all">
    <p>def <span class="ident">plot_pupil_dilation_all</span>(</p><p>participants, outdir, scene)</p>
    </div>
    

    
  
    <div class="desc"><p>Plots adjusted pupil dilations to</p>
<p>Args:
    participants: collection of Participant objects</p>
<pre><code>outdir: directory where files should be exported

scene: name of scene to be exported
</code></pre>
<p>Returns:</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-BasicParticipant_multiprocessing.plot_pupil_dilation_all', this);">Show source &equiv;</a></p>
  <div id="source-BasicParticipant_multiprocessing.plot_pupil_dilation_all" class="source">
    <pre><code>def plot_pupil_dilation_all(participants, outdir, scene):
    """
    Plots adjusted pupil dilations to

    Args:
        participants: collection of Participant objects

        outdir: directory where files should be exported

        scene: name of scene to be exported

    Returns:

    """
    lines = []
    for participant in participants:
        lines = export_pupil_dilation_from_scene(participant, scene, separator = "\t")
        with open(outdir + "pupildata" + "_" + str(participant.pid) + "_" + str(scene) + ".tsv", "w") as fout:
            if lines is not None:
                for line in lines:
                    fout.write(line)
            else:
                fout.write("There is no scene " + str(scene) + " in the participant " + str(participant.pid) + " record ")
</code></pre>
  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="BasicParticipant_multiprocessing.read_events">
    <p>def <span class="ident">read_events</span>(</p><p>evfile)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a list of Event objects read from an 'Event-Data.tsv' file.</p>
<p>Args:
    evfile: a string containing the name of the 'Event-Data.tsv' file exported by
        Tobii software</p>
<p>Returns:
    a list of Event objects</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-BasicParticipant_multiprocessing.read_events', this);">Show source &equiv;</a></p>
  <div id="source-BasicParticipant_multiprocessing.read_events" class="source">
    <pre><code>def read_events(evfile):
    """Returns a list of Event objects read from an 'Event-Data.tsv' file.

    Args:
        evfile: a string containing the name of the 'Event-Data.tsv' file exported by
            Tobii software

    Returns:
        a list of Event objects
    """
    with open(evfile, 'r') as f:
        lines = f.readlines()

    return map(Event, lines[(params.EVENTSHEADERLINES+params.NUMBEROFEXTRAHEADERLINES):])
</code></pre>
  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="BasicParticipant_multiprocessing.read_participants_Basic">
    <p>def <span class="ident">read_participants_Basic</span>(</p><p>q, datadir, user_list, pids, prune_length=None, aoifile=None, log_time_offsets=None, require_valid_segs=True, auto_partition_low_quality_segments=False, rpsfile=None, export_pupilinfo=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Generates list of Participant objects. Relevant information is read from input files</p>
<p>Args:
    q: Queue to which all processes must add return values.</p>
<pre><code>datadir: directory with user data (including "All-Data.tsv", "Fixation-Data.tsv", "Event-Data.tsv" files)
for all participants

user_list: list of user recordings (files extracted for one participant from Tobii studio)

pids: User ID that is used in the external logs (can be different from above but there should be a 1-1 mapping)

prune_length: If not None, an integer that specifies the time
    interval (in ms) from the beginning of each Segment in which
    samples are considered in calculations.  This can be used if,
    for example, you only wish to consider data in the first
    1000 ms of each Segment. In this case (prune_length = 1000),
    all data beyond the first 1000ms of the start of the "Segment"s
    will be disregarded.

aoifile: If not None, a string containing the name of the '.aoi' file
    with definitions of the "AOI"s.

log_time_offset: If not None, an integer indicating the time offset between the
    external log file and eye tracking logs

require_valid_segs: a boolean determining whether invalid "Segment"s
    will be ignored when calculating the features or not. default = True

auto_partition_low_quality_segments: a boolean indicating whether EMDAT should
    split the "Segment"s which have low sample quality, into two new
    sub "Segment"s discarding the largest gap of invalid samples.

rpsfile: If not None, a string containing the name of the '.tsv' file
    with rest pupil sizes for all scenes and for each user.
</code></pre>
<p>Returns:
    a list Participant objects (in queue)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-BasicParticipant_multiprocessing.read_participants_Basic', this);">Show source &equiv;</a></p>
  <div id="source-BasicParticipant_multiprocessing.read_participants_Basic" class="source">
    <pre><code>def read_participants_Basic(q, datadir, user_list, pids, prune_length = None, aoifile = None, log_time_offsets=None,
                          require_valid_segs = True, auto_partition_low_quality_segments = False, rpsfile = None, export_pupilinfo = False):
    """Generates list of Participant objects. Relevant information is read from input files

    Args:
        q: Queue to which all processes must add return values.

        datadir: directory with user data (including "All-Data.tsv", "Fixation-Data.tsv", "Event-Data.tsv" files)
        for all participants

        user_list: list of user recordings (files extracted for one participant from Tobii studio)

        pids: User ID that is used in the external logs (can be different from above but there should be a 1-1 mapping)

        prune_length: If not None, an integer that specifies the time
            interval (in ms) from the beginning of each Segment in which
            samples are considered in calculations.  This can be used if,
            for example, you only wish to consider data in the first
            1000 ms of each Segment. In this case (prune_length = 1000),
            all data beyond the first 1000ms of the start of the "Segment"s
            will be disregarded.

        aoifile: If not None, a string containing the name of the '.aoi' file
            with definitions of the "AOI"s.

        log_time_offset: If not None, an integer indicating the time offset between the
            external log file and eye tracking logs

        require_valid_segs: a boolean determining whether invalid "Segment"s
            will be ignored when calculating the features or not. default = True

        auto_partition_low_quality_segments: a boolean indicating whether EMDAT should
            split the "Segment"s which have low sample quality, into two new
            sub "Segment"s discarding the largest gap of invalid samples.

        rpsfile: If not None, a string containing the name of the '.tsv' file
            with rest pupil sizes for all scenes and for each user.

    Returns:
        a list Participant objects (in queue)
    """
    participants = []
    if log_time_offsets == None:    #setting the default offset which is 1 sec
        log_time_offsets = [0]*len(pids)

    # read rest pupil sizes (rpsvalues) from rpsfile
    rpsdata = read_rest_pupil_sizes(rpsfile)

    for rec,pid,offset in zip(user_list,pids,log_time_offsets):
        #extract pupil sizes for the current user. Set to None if not available
        if rpsdata != None:
            currpsdata = rpsdata[pid]
        else:
            currpsdata = None

        if params.EYETRACKERTYPE == "TobiiV2":
            allfile = datadir+'/TobiiV2/P'+str(rec)+'-All-Data.tsv'
            fixfile = datadir+'/TobiiV2/P'+str(rec)+'-Fixation-Data.tsv'
            evefile = datadir+'/TobiiV2/P'+str(rec)+'-Event-Data.tsv'
            sacfile = None
            segfile = datadir+'/TobiiV2/P'+str(rec)+'.seg'
        elif params.EYETRACKERTYPE == "TobiiV3":
            allfile = "{dir}/TobiiV3/P{rec}_Data_Export.tsv".format(dir=datadir, rec=rec)
            fixfile = "{dir}/TobiiV3/P{rec}_Data_Export.tsv".format(dir=datadir, rec=rec)
            sacfile = "{dir}/TobiiV3/P{rec}_Data_Export.tsv".format(dir=datadir, rec=rec)
            evefile = "{dir}/TobiiV3/P{rec}_Data_Export.tsv".format(dir=datadir, rec=rec)
            segfile = "{dir}/TobiiV3/TobiiV3_sample_{rec}.seg".format(dir=datadir, rec=rec)
            #aoifile = "{dir}/TobiiV3/TobiiV3_sample_{rec}.aoi".format(dir=datadir, rec=rec)
        elif params.EYETRACKERTYPE == "SMI":
            allfile = "{dir}/SMI/SMI_Sample_{rec}_Samples.txt".format(dir=datadir, rec=rec)
            fixfile = "{dir}/SMI/SMI_Sample_{rec}_Events.txt".format(dir=datadir, rec=rec)
            sacfile = "{dir}/SMI/SMI_Sample_{rec}_Events.txt".format(dir=datadir, rec=rec)
            evefile = "{dir}/SMI/SMI_Sample_{rec}_Events.txt".format(dir=datadir, rec=rec)
            segfile = "{dir}/SMI/SMI_Sample_{rec}.seg".format(dir=datadir, rec=rec)

        if os.path.exists(allfile):
            p = BasicParticipant(rec, evefile, allfile, fixfile, sacfile, segfile, log_time_offset = offset,
                                aoifile=aoifile, prune_length = prune_length, require_valid_segs = require_valid_segs,
                                auto_partition_low_quality_segments = auto_partition_low_quality_segments, rpsdata = currpsdata)
            participants.append(p)
        else:
            print "Error reading participant files for: "+str(pid)
    q.put(participants)
    return
</code></pre>
  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="BasicParticipant_multiprocessing.read_participants_Basic_multiprocessing">
    <p>def <span class="ident">read_participants_Basic_multiprocessing</span>(</p><p>nbprocesses, datadir, user_list, pids, prune_length=None, aoifile=None, log_time_offsets=None, require_valid_segs=True, auto_partition_low_quality_segments=False, rpsfile=None, export_pupilinfo=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Generates list of Participant objects in parallel computing. Relevant information is read from input files</p>
<p>Args:
    nbprocesses: number of processes to run in parallel (number of CPU cores is a good option).</p>
<pre><code>datadir: directory with user data (including "All-Data.tsv", "Fixation-Data.tsv", "Event-Data.tsv" files)
for all participants

user_list: list of user recordings (files extracted for one participant from Tobii studio)

pids: User ID that is used in the external logs (can be different from above but there should be a 1-1 mapping)

prune_length: If not None, an integer that specifies the time
    interval (in ms) from the beginning of each Segment in which
    samples are considered in calculations.  This can be used if,
    for example, you only wish to consider data in the first
    1000 ms of each Segment. In this case (prune_length = 1000),
    all data beyond the first 1000ms of the start of the "Segment"s
    will be disregarded.

aoifile: If not None, a string containing the name of the '.aoi' file
    with definitions of the "AOI"s.

log_time_offset: If not None, an integer indicating the time offset between the
    external log file and eye tracking logs

require_valid_segs: a boolean determining whether invalid "Segment"s
    will be ignored when calculating the features or not. default = True

auto_partition_low_quality_segments: a boolean indicating whether EMDAT should
    split the "Segment"s which have low sample quality, into two new
    sub "Segment"s discarding the largest gap of invalid samples.

rpsfile: If not None, a string containing the name of the '.tsv' file
    with rest pupil sizes for all scenes and for each user.
</code></pre>
<p>Returns:
    a list Participant objects</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-BasicParticipant_multiprocessing.read_participants_Basic_multiprocessing', this);">Show source &equiv;</a></p>
  <div id="source-BasicParticipant_multiprocessing.read_participants_Basic_multiprocessing" class="source">
    <pre><code>def read_participants_Basic_multiprocessing(nbprocesses, datadir, user_list, pids, prune_length = None, aoifile = None, log_time_offsets = None,
                          require_valid_segs = True, auto_partition_low_quality_segments = False, rpsfile = None, export_pupilinfo = False):
    """Generates list of Participant objects in parallel computing. Relevant information is read from input files

    Args:
        nbprocesses: number of processes to run in parallel (number of CPU cores is a good option).

        datadir: directory with user data (including "All-Data.tsv", "Fixation-Data.tsv", "Event-Data.tsv" files)
        for all participants

        user_list: list of user recordings (files extracted for one participant from Tobii studio)

        pids: User ID that is used in the external logs (can be different from above but there should be a 1-1 mapping)

        prune_length: If not None, an integer that specifies the time
            interval (in ms) from the beginning of each Segment in which
            samples are considered in calculations.  This can be used if,
            for example, you only wish to consider data in the first
            1000 ms of each Segment. In this case (prune_length = 1000),
            all data beyond the first 1000ms of the start of the "Segment"s
            will be disregarded.

        aoifile: If not None, a string containing the name of the '.aoi' file
            with definitions of the "AOI"s.

        log_time_offset: If not None, an integer indicating the time offset between the
            external log file and eye tracking logs

        require_valid_segs: a boolean determining whether invalid "Segment"s
            will be ignored when calculating the features or not. default = True

        auto_partition_low_quality_segments: a boolean indicating whether EMDAT should
            split the "Segment"s which have low sample quality, into two new
            sub "Segment"s discarding the largest gap of invalid samples.

        rpsfile: If not None, a string containing the name of the '.tsv' file
            with rest pupil sizes for all scenes and for each user.

    Returns:
        a list Participant objects
    """

    q = Queue()
    listprocess = []
    participants = []

    if nbprocesses < 1:
        nbprocesses = 1
    if nbprocesses > len(user_list):
        nbprocesses = len(user_list)

    for i in range(0, nbprocesses): #create a sublist of participants for each process
        user_listsplit = chunks(user_list, nbprocesses)
        pidssplit = chunks(pids, nbprocesses)
        log_time_offsets_list = chunks(log_time_offsets, nbprocesses) if log_time_offsets is not None else None

    print user_listsplit
    try:
        for i in range(0, nbprocesses):
            if log_time_offsets is None:
			    p = Process(target=read_participants_Basic, args=(q, datadir, user_listsplit[i], pidssplit[i], prune_length, aoifile, log_time_offsets,
                          require_valid_segs, auto_partition_low_quality_segments, rpsfile, export_pupilinfo))
            else:
			    p = Process(target=read_participants_Basic, args=(q, datadir, user_listsplit[i], pidssplit[i], prune_length, aoifile, log_time_offsets_list[i],
                          require_valid_segs, auto_partition_low_quality_segments, rpsfile, export_pupilinfo))

            listprocess.append(p)
            p.start() # start the process

        for i in range(0, nbprocesses):
            participants = participants + q.get(True) # wait for the results of all processes

        for pr in listprocess:
            pr.terminate()
            pr.join() #kill the process

    except  Exception as e:
        exc_type, exc_obj, exc_tb = sys.exc_info()
        print "Exception", sys.exc_info()
        print "Line ", exc_tb.tb_lineno

    return participants
</code></pre>
  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="BasicParticipant_multiprocessing.read_rest_pupil_sizes">
    <p>def <span class="ident">read_rest_pupil_sizes</span>(</p><p>rpsfile)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a dictionary of rest pupil sizes for all scenes if rpsfile is provided. None otherwise
The input file has the following format:
    pid     <scene name 1>  <scene name 2>....</p>
<pre><code>&lt;pid 1&gt; &lt;rest pupil size 1&gt;     &lt;rest pupil size 2&gt;
</code></pre>
<p>Args:
    rpsfile: a string containing the name of the '.tsv' file
        with rest pupil sizes for all partiicpants and all scenes.</p>
<p>Returns:
    a dictionary of rest pupil sizes. None otherwise</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-BasicParticipant_multiprocessing.read_rest_pupil_sizes', this);">Show source &equiv;</a></p>
  <div id="source-BasicParticipant_multiprocessing.read_rest_pupil_sizes" class="source">
    <pre><code>def read_rest_pupil_sizes(rpsfile):
    """
    Returns a dictionary of rest pupil sizes for all scenes if rpsfile is provided. None otherwise
    The input file has the following format:
        pid\t<scene name 1>\t<scene name 2>....\n
        <pid 1>\t<rest pupil size 1>\t<rest pupil size 2>

    Args:
        rpsfile: a string containing the name of the '.tsv' file
            with rest pupil sizes for all partiicpants and all scenes.

    Returns:
        a dictionary of rest pupil sizes. None otherwise

    """
    if rpsfile != None:
        with open(rpsfile, 'r') as f:
            lines = f.readlines()
        rpsdic = {}
        import re
        scenelist = re.findall('\w+', lines[0])
        for line in lines[1:]:
            linelist = re.findall('\w+', line)
            pid = cast_int(linelist[0])
            if pid == None: #if casting didn't work
                pid = linelist[0]
            rpsdic[pid] = {}
            for scene, rpsvalue in zip(scenelist[1:], linelist[1:]):
                rpsdic[pid][scene] = cast_int(rpsvalue)

        return rpsdic
    else:
        return None
</code></pre>
  </div>
</div>

  </div>
  

    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="BasicParticipant_multiprocessing.BasicParticipant" class="name">class <span class="ident">BasicParticipant</span></p>
      
  
    <div class="desc"><p>This is a sample child class based on the Participant class that implements all the
placeholder methods in the Participant class for a basic project</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-BasicParticipant_multiprocessing.BasicParticipant', this);">Show source &equiv;</a></p>
  <div id="source-BasicParticipant_multiprocessing.BasicParticipant" class="source">
    <pre><code>class BasicParticipant(Participant):
    """
    This is a sample child class based on the Participant class that implements all the
    placeholder methods in the Participant class for a basic project
    """
    def __init__(self, pid, eventfile, datafile, fixfile, saccfile, segfile, log_time_offset = None, aoifile = None, prune_length= None,
                 require_valid_segs = True, auto_partition_low_quality_segments = False, rpsdata = None, export_pupilinfo = False):
        """Inits BasicParticipant class
        Args:
            pid: Participant id

            eventfile: a string containing the name of the "Event-Data.tsv" file for this participant

            datafile: a string containing the name of the "All-Data.tsv" file for this participant

            fixfile: a string containing the name of the "Fixation-Data.tsv" file for this participant

            segfile: a string containing the name of the '.seg' file for this participant

            log_time_offset: If not None, an integer indicating the time offset between the
                external log file and eye tracking logs

            aoifile: If not None, a string containing the name of the '.aoi' file
                with definitions of the "AOI"s.

            prune_length: If not None, an integer that specifies the time
                interval (in ms) from the beginning of each Segment in which
                samples are considered in calculations.  This can be used if,
                for example, you only wish to consider data in the first
                1000 ms of each Segment. In this case (prune_length = 1000),
                all data beyond the first 1000ms of the start of the "Segment"s
                will be disregarded.

            auto_partition_low_quality_segments: a boolean indicating whether EMDAT should
                split the "Segment"s which have low sample quality, into two new
                sub "Segment"s discarding the largest gap of invalid samples.

            rpsdata: rest pupil sizes for all scenes if available

        Yields:
            a BasicParticipant object
        """


        Participant.__init__(self, pid, eventfile, datafile, fixfile, saccfile, segfile, log_time_offset, aoifile, prune_length,
                 require_valid_segs, auto_partition_low_quality_segments, rpsdata)   #calling the Participant's constructor

        print "Participant \""+str(pid)+"\"..."
        if params.VERBOSE != "QUIET":
            print "Reading input files:"
            print "--Scenes/Segments file: "+segfile
            print "--Eye tracking samples file: "+datafile
            print "--Fixations file: "+fixfile
            print "--Saccades file: "+saccfile if saccfile is not None else "--No saccades file"
            print "--Events file: "+eventfile if eventfile is not None else "--No events file"
            print "--AOIs file: "+aoifile if aoifile is not None else "--No AOIs file"
            print

        self.features={}
        if params.EYETRACKERTYPE == "TobiiV2":
            rec = TobiiV2Recording(datafile, fixfile, event_file=eventfile, media_offset=params.MEDIA_OFFSET)
        elif params.EYETRACKERTYPE == "TobiiV3":
            rec = TobiiV3Recording(datafile, fixfile, saccade_file=saccfile, event_file=eventfile, media_offset=params.MEDIA_OFFSET)
        elif params.EYETRACKERTYPE == "SMI":
            rec = SMIRecording(datafile, fixfile, saccade_file=saccfile, event_file=eventfile, media_offset=params.MEDIA_OFFSET)
        else:
            raise Exception("Unknown eye tracker type.")

        if params.VERBOSE != "QUIET":
            print "Creating partition..."

        scenelist,self.numofsegments = partition(segfile)
        if self.numofsegments == 0:
            raise Exception("No segments found.")

        if aoifile is not None:
            aois = read_aois(aoifile)
        else:
            aois = None

        self.features['numofsegments'] = self.numofsegments

        if params.VERBOSE != "QUIET":
            print "Generating features..."

        self.segments, self.scenes = rec.process_rec(scenelist = scenelist,aoilist = aois,prune_length = prune_length, require_valid_segs = require_valid_segs,
                                                     auto_partition_low_quality_segments = auto_partition_low_quality_segments, rpsdata = rpsdata, export_pupilinfo=export_pupilinfo)

        all_segs = sorted(self.segments, key=lambda x: x.start)
        self.whole_scene = Scene(str(pid)+'_allsc',[],rec.all_data,rec.fix_data, saccade_data = rec.sac_data, event_data = rec.event_data, Segments = all_segs, aoilist = aois,prune_length = prune_length, require_valid = require_valid_segs, export_pupilinfo=export_pupilinfo )
        self.scenes.insert(0,self.whole_scene)

        #Clean memory
        for sc in self.scenes:
            sc.clean_memory()
        rec.clean_memory()

        if params.VERBOSE != "QUIET":
            print "Done!"
</code></pre>
  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#BasicParticipant_multiprocessing.BasicParticipant">BasicParticipant</a></li>
          <li>EMDAT_core.Participant.Participant</li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="BasicParticipant_multiprocessing.BasicParticipant.features" class="name">var <span class="ident">features</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="BasicParticipant_multiprocessing.BasicParticipant.whole_scene" class="name">var <span class="ident">whole_scene</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="BasicParticipant_multiprocessing.BasicParticipant.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, pid, eventfile, datafile, fixfile, saccfile, segfile, log_time_offset=None, aoifile=None, prune_length=None, require_valid_segs=True, auto_partition_low_quality_segments=False, rpsdata=None, export_pupilinfo=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Inits BasicParticipant class
Args:
    pid: Participant id</p>
<pre><code>eventfile: a string containing the name of the "Event-Data.tsv" file for this participant

datafile: a string containing the name of the "All-Data.tsv" file for this participant

fixfile: a string containing the name of the "Fixation-Data.tsv" file for this participant

segfile: a string containing the name of the '.seg' file for this participant

log_time_offset: If not None, an integer indicating the time offset between the
    external log file and eye tracking logs

aoifile: If not None, a string containing the name of the '.aoi' file
    with definitions of the "AOI"s.

prune_length: If not None, an integer that specifies the time
    interval (in ms) from the beginning of each Segment in which
    samples are considered in calculations.  This can be used if,
    for example, you only wish to consider data in the first
    1000 ms of each Segment. In this case (prune_length = 1000),
    all data beyond the first 1000ms of the start of the "Segment"s
    will be disregarded.

auto_partition_low_quality_segments: a boolean indicating whether EMDAT should
    split the "Segment"s which have low sample quality, into two new
    sub "Segment"s discarding the largest gap of invalid samples.

rpsdata: rest pupil sizes for all scenes if available
</code></pre>
<p>Yields:
    a BasicParticipant object</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-BasicParticipant_multiprocessing.BasicParticipant.__init__', this);">Show source &equiv;</a></p>
  <div id="source-BasicParticipant_multiprocessing.BasicParticipant.__init__" class="source">
    <pre><code>def __init__(self, pid, eventfile, datafile, fixfile, saccfile, segfile, log_time_offset = None, aoifile = None, prune_length= None,
             require_valid_segs = True, auto_partition_low_quality_segments = False, rpsdata = None, export_pupilinfo = False):
    """Inits BasicParticipant class
    Args:
        pid: Participant id
        eventfile: a string containing the name of the "Event-Data.tsv" file for this participant
        datafile: a string containing the name of the "All-Data.tsv" file for this participant
        fixfile: a string containing the name of the "Fixation-Data.tsv" file for this participant
        segfile: a string containing the name of the '.seg' file for this participant
        log_time_offset: If not None, an integer indicating the time offset between the
            external log file and eye tracking logs
        aoifile: If not None, a string containing the name of the '.aoi' file
            with definitions of the "AOI"s.
        prune_length: If not None, an integer that specifies the time
            interval (in ms) from the beginning of each Segment in which
            samples are considered in calculations.  This can be used if,
            for example, you only wish to consider data in the first
            1000 ms of each Segment. In this case (prune_length = 1000),
            all data beyond the first 1000ms of the start of the "Segment"s
            will be disregarded.
        auto_partition_low_quality_segments: a boolean indicating whether EMDAT should
            split the "Segment"s which have low sample quality, into two new
            sub "Segment"s discarding the largest gap of invalid samples.
        rpsdata: rest pupil sizes for all scenes if available
    Yields:
        a BasicParticipant object
    """
    Participant.__init__(self, pid, eventfile, datafile, fixfile, saccfile, segfile, log_time_offset, aoifile, prune_length,
             require_valid_segs, auto_partition_low_quality_segments, rpsdata)   #calling the Participant's constructor
    print "Participant \""+str(pid)+"\"..."
    if params.VERBOSE != "QUIET":
        print "Reading input files:"
        print "--Scenes/Segments file: "+segfile
        print "--Eye tracking samples file: "+datafile
        print "--Fixations file: "+fixfile
        print "--Saccades file: "+saccfile if saccfile is not None else "--No saccades file"
        print "--Events file: "+eventfile if eventfile is not None else "--No events file"
        print "--AOIs file: "+aoifile if aoifile is not None else "--No AOIs file"
        print
    self.features={}
    if params.EYETRACKERTYPE == "TobiiV2":
        rec = TobiiV2Recording(datafile, fixfile, event_file=eventfile, media_offset=params.MEDIA_OFFSET)
    elif params.EYETRACKERTYPE == "TobiiV3":
        rec = TobiiV3Recording(datafile, fixfile, saccade_file=saccfile, event_file=eventfile, media_offset=params.MEDIA_OFFSET)
    elif params.EYETRACKERTYPE == "SMI":
        rec = SMIRecording(datafile, fixfile, saccade_file=saccfile, event_file=eventfile, media_offset=params.MEDIA_OFFSET)
    else:
        raise Exception("Unknown eye tracker type.")
    if params.VERBOSE != "QUIET":
        print "Creating partition..."
    scenelist,self.numofsegments = partition(segfile)
    if self.numofsegments == 0:
        raise Exception("No segments found.")
    if aoifile is not None:
        aois = read_aois(aoifile)
    else:
        aois = None
    self.features['numofsegments'] = self.numofsegments
    if params.VERBOSE != "QUIET":
        print "Generating features..."
    self.segments, self.scenes = rec.process_rec(scenelist = scenelist,aoilist = aois,prune_length = prune_length, require_valid_segs = require_valid_segs,
                                                 auto_partition_low_quality_segments = auto_partition_low_quality_segments, rpsdata = rpsdata, export_pupilinfo=export_pupilinfo)
    all_segs = sorted(self.segments, key=lambda x: x.start)
    self.whole_scene = Scene(str(pid)+'_allsc',[],rec.all_data,rec.fix_data, saccade_data = rec.sac_data, event_data = rec.event_data, Segments = all_segs, aoilist = aois,prune_length = prune_length, require_valid = require_valid_segs, export_pupilinfo=export_pupilinfo )
    self.scenes.insert(0,self.whole_scene)
    #Clean memory
    for sc in self.scenes:
        sc.clean_memory()
    rec.clean_memory()
    if params.VERBOSE != "QUIET":
        print "Done!"
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="BasicParticipant_multiprocessing.BasicParticipant.export_features">
    <p>def <span class="ident">export_features</span>(</p><p>self, featurelist=None, aoifeaturelist=None, aoifeaturelabels=None, id_prefix=True, require_valid=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns feature names and their values for this Participant</p>
<p>Args:
    featurelist: if not None, a list of strings containing the name of the features to be
        returned</p>
<pre><code>aoifeaturelist: if not None, a list of features to be returned for each of the "AOI"s.
aoifeaturelabels: if not None, a list of AOI related features to be returned.
*Note: while aoifeaturelist is a subset of features that will be returned for all
"AOI"s, aoifeaturelabels contains the exact AOI feature name, i.e., a feature
of the form: [AOI name]_[feature name]
For example for an AOI called 'graph', aoifeaturelabels may contain 'graph_fixationrate'

id_prefix: a boolean determining if the method should also export the participant id

require_valid: a boolean determining if only valid segments should be used when
calculating the features. default = True
</code></pre>
<p>Returns:
    featnames: a list of feature names sorted alphabetically
    featvals: a corresponding list of feature values
    e.g.
    featnames = ['fixationrate', 'length', 'meanabspathangles']
    featvals  = [0.00268522882294', '1529851', '1.60354714212']</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-BasicParticipant_multiprocessing.BasicParticipant.export_features', this);">Show source &equiv;</a></p>
  <div id="source-BasicParticipant_multiprocessing.BasicParticipant.export_features" class="source">
    <pre><code>def export_features(self, featurelist=None, aoifeaturelist=None, aoifeaturelabels = None,
                    id_prefix = True, require_valid = True):
    """Returns feature names and their values for this Participant
    Args:
        featurelist: if not None, a list of strings containing the name of the features to be
            returned
        aoifeaturelist: if not None, a list of features to be returned for each of the "AOI"s.
        aoifeaturelabels: if not None, a list of AOI related features to be returned.
        *Note: while aoifeaturelist is a subset of features that will be returned for all
        "AOI"s, aoifeaturelabels contains the exact AOI feature name, i.e., a feature
        of the form: [AOI name]_[feature name]
        For example for an AOI called 'graph', aoifeaturelabels may contain 'graph_fixationrate'
        id_prefix: a boolean determining if the method should also export the participant id
        require_valid: a boolean determining if only valid segments should be used when
        calculating the features. default = True
    Returns:
        featnames: a list of feature names sorted alphabetically
        featvals: a corresponding list of feature values
        e.g.
        featnames = ['fixationrate', 'length', 'meanabspathangles']
        featvals  = [0.00268522882294', '1529851', '1.60354714212']
    """
    data = []
    featnames = []
    if id_prefix:
        featnames.append('Part_id')
    featnames.append('Sc_id')
    first = True
    for sc in self.scenes:
        if not sc.is_valid and require_valid:
            warn( "User %s:Scene %s dropped because of 'require_valid'" %(self.pid,sc.scid) )
            continue
        sc_feats = []
        if id_prefix:
            sc_feats.append(self.pid)
        sc_feats.append(sc.scid)
        fnames, fvals = sc.get_features(featurelist = featurelist,
                                       aoifeaturelist = aoifeaturelist,
                                       aoifeaturelabels = aoifeaturelabels)
        if first: featnames += fnames
        sc_feats += fvals
        first = False
        data.append(sc_feats)
    return featnames, data
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="BasicParticipant_multiprocessing.BasicParticipant.export_features_tsv">
    <p>def <span class="ident">export_features_tsv</span>(</p><p>self, featurelist=None, aoifeaturelist=None, id_prefix=False, require_valid=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns feature names and their values for this Participant in a tab separated format</p>
<p>Args:
    featurelist: if not None, a list of strings containing the name of the features to be
        returned</p>
<pre><code>aoifeaturelist: if not None, a list of features to be returned for each of the "AOI"s.

id_prefix: a boolean determining if the method should also export the participant id.


require_valid: a boolean determining if only valid segments should be used when
calculating the features. default = True
</code></pre>
<p>Returns:
    A two-line string with the first line having the feature names sorted alphabetically
    and separated by a tab '/t', and the second line containing the corresponding values
    separated by a tab '/t'
    For example:
    fixationrate    length    meanabspathangles
    0.00268522882294    1529851    1.60354714212</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-BasicParticipant_multiprocessing.BasicParticipant.export_features_tsv', this);">Show source &equiv;</a></p>
  <div id="source-BasicParticipant_multiprocessing.BasicParticipant.export_features_tsv" class="source">
    <pre><code>def export_features_tsv(self, featurelist=None, aoifeaturelist=None, id_prefix = False,
                        require_valid = True):
    """Returns feature names and their values for this Participant in a tab separated format
    Args:
        featurelist: if not None, a list of strings containing the name of the features to be
            returned
        aoifeaturelist: if not None, a list of features to be returned for each of the "AOI"s.
        id_prefix: a boolean determining if the method should also export the participant id.
        require_valid: a boolean determining if only valid segments should be used when
        calculating the features. default = True
    Returns:
        A two-line string with the first line having the feature names sorted alphabetically
        and separated by a tab '/t', and the second line containing the corresponding values
        separated by a tab '/t'
        For example:
        fixationrate    length    meanabspathangles
        0.00268522882294    1529851    1.60354714212
    """
    featnames, data  = self.export_features(featurelist, aoifeaturelist = aoifeaturelist,
                                            id_prefix = id_prefix, require_valid = require_valid)
    ret = string.join(featnames, '\t') + '\n'
    for t in data:
        ret += (string.join(map(str, t), '\t') + '\n')
    return ret
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="BasicParticipant_multiprocessing.BasicParticipant.invalid_segments">
    <p>def <span class="ident">invalid_segments</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a list of invalid segments in this particiapnt's eye gaze data</p>
<p>Returns:
    a list of "Segment ids" of invalid Segments in this particiapnt's eye gaze data</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-BasicParticipant_multiprocessing.BasicParticipant.invalid_segments', this);">Show source &equiv;</a></p>
  <div id="source-BasicParticipant_multiprocessing.BasicParticipant.invalid_segments" class="source">
    <pre><code>def invalid_segments(self):
    """Returns a list of invalid segments in this particiapnt's eye gaze data
    Returns:
        a list of "Segment ids" of invalid Segments in this particiapnt's eye gaze data
    """
    return map(lambda y: y.segid, filter(lambda x: not x.is_valid, self.segments))
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="BasicParticipant_multiprocessing.BasicParticipant.is_valid">
    <p>def <span class="ident">is_valid</span>(</p><p>self, method=None, threshold=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Determines if the samples for this Participant meets the validity threshold</p>
<p>Args:
    threshold: if not None, the threshold value that should be used for the
        validity criterion</p>
<p>Returns:
    True or False</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-BasicParticipant_multiprocessing.BasicParticipant.is_valid', this);">Show source &equiv;</a></p>
  <div id="source-BasicParticipant_multiprocessing.BasicParticipant.is_valid" class="source">
    <pre><code>def is_valid(self, method = None, threshold=None, ):
    """Determines if the samples for this Participant meets the validity threshold
    Args:
        threshold: if not None, the threshold value that should be used for the
            validity criterion
    Returns:
        True or False
    """
    if threshold == None:
        return self.whole_scene.is_valid
    elif method == None:
        method = params.VALIDITY_METHOD
    if method == 1:
        return self.whole_scene.calc_validity1(threshold)
    elif method == 2:
        return self.whole_scene.calc_validity2(threshold)
    elif method == 3:
        return self.whole_scene.calc_validity3(threshold)
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="BasicParticipant_multiprocessing.BasicParticipant.print_">
    <p>def <span class="ident">print_</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Outputs all feature names and their values for this Participant to the console</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-BasicParticipant_multiprocessing.BasicParticipant.print_', this);">Show source &equiv;</a></p>
  <div id="source-BasicParticipant_multiprocessing.BasicParticipant.print_" class="source">
    <pre><code>def print_(self):
    """Outputs all feature names and their values for this Participant to the console
    """
    def format_list(list,leng=None):
        """
        """
        out=''
        if leng == None:
            maxlen=0
            for j in list:
                st = repr(j)
                if len(st) > maxlen:
                    maxlen = len(st)
            for j in list:
                out+= repr(j).rjust(maxlen+1)
            return out,maxlen+1
        else:
            for j in list:
                st = repr(j)
                out+= st.rjust(leng)
            return out,leng
    print("PID:", self.pid)
    for seg in self.segments:
        featnames = []
        if not seg.is_valid:
            continue
        seg_feats = []
        featnames.append('seg_id')
        seg_feats.append(seg.segid)
        fnames, fvals = seg.get_features()
        featnames += fnames
        seg_feats += fvals
        o,l= format_list(featnames)
        print(o)
        print(format_list(seg_feats,l))
    for sc in self.scenes:
        featnames = []
        if not sc.is_valid:
            continue
        sc_feats = []
        featnames.append('sc_id')
        sc_feats.append(sc.scid)
        fnames, fvals = sc.get_features()
        featnames += fnames
        sc_feats += fvals
        o,l= format_list(featnames)
        print(o)
        print(format_list(sc_feats,l))
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="BasicParticipant_multiprocessing.BasicParticipant.valid_segments">
    <p>def <span class="ident">valid_segments</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a list of valid segments in this particiapnt's eye gaze data</p>
<p>Returns:
    a list of "Segment ids" of invalid Segments in this particiapnt's eye gaze data</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-BasicParticipant_multiprocessing.BasicParticipant.valid_segments', this);">Show source &equiv;</a></p>
  <div id="source-BasicParticipant_multiprocessing.BasicParticipant.valid_segments" class="source">
    <pre><code>def valid_segments(self):
    """Returns a list of valid segments in this particiapnt's eye gaze data
    Returns:
        a list of "Segment ids" of invalid Segments in this particiapnt's eye gaze data
    """
    return map(lambda y: y.segid, filter(lambda x: x.is_valid, self.segments))
</code></pre>
  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="BasicParticipant_multiprocessing.BasicParticipant.write_raw_data">
    <p>def <span class="ident">write_raw_data</span>(</p><p>self, filename_all, filename_fix, filename_sac, filename_ev)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-BasicParticipant_multiprocessing.BasicParticipant.write_raw_data', this);">Show source &equiv;</a></p>
  <div id="source-BasicParticipant_multiprocessing.BasicParticipant.write_raw_data" class="source">
    <pre><code>def write_raw_data(self, filename_all, filename_fix, filename_sac, filename_ev):
    f_all = open(filename_all, 'wb')
    f_fix = open(filename_fix, 'wb')
    f_sac = open(filename_sac, 'wb')
    f_ev = open(filename_ev, 'wb')
    sep='\t'
    f_all.write("scene"+sep+"timestamp"+sep+"rawpupilsize"+sep+"pupilvelocity"+sep+"headdistance"+sep+"is_valid"+sep+"stimuliname"+sep+
ixationindex"+"\n")
    f_fix.write("scene"+sep+"fixationindex"+sep+"timestamp"+sep+"fixationduration"+sep+"mappedfixationpointx"+sep+"mappedfixationpointy"+"\n")
    f_sac.write("scene"+sep+"saccadeindex"+sep+"timestamp"+sep+"saccadeduration"+sep+"saccadedistance"+sep+"saccadespeed"+sep+"saccadeacceleration"+sep+
accadestartpointx"+sep+"saccadestartpointy"+sep+"saccadeendpointx"+sep+"saccadeendpointy"+sep+"saccadequality"+"\n")
    f_ev.write("scene"+sep+"timestamp"+sep+"event"+sep+"event_key"+sep+"x_coord"+sep+"y_coord"+sep+"key_code"+sep+"key_name"+sep+"description"+sep+"\n")
    for sc in self.scenes:
        for sg in sc.segments:
            for ad in sg.all_data:
                f_all.write(str(sc.scid)+str(sg.segid)+sep+ad.get_string()+'\n')
            for af in sg.fixation_data:
                f_fix.write(str(sc.scid)+str(sg.segid)+sep+af.get_string()+'\n')
            for asa in sg.saccade_data:
                f_sac.write(str(sc.scid)+str(sg.segid)+sep+asa.get_string()+'\n')
            for ae in sg.event_data:
                f_ev.write(str(sc.scid)+str(sg.segid)+sep+ae.get_string()+'\n')
    f_all.close()
    f_fix.close()
</code></pre>
  </div>
</div>

  </div>
  
      </div>
      </div>

    <h2 class="section-title" id="header-submodules">Sub-modules</h2>
      <div class="item">
      <p class="name"><a href="params.m.html">BasicParticipant_multiprocessing.params</a></p>
      
  
    <div class="desc"><p>UBC Eye Movement Data Analysis Toolkit (EMDAT), Version 3</p>
<p>Module that contains all global parameters. Values of parameters are specific to the project.</p>
<p>@author: Samad Kardan (creator), Sebastien Lalle
Institution: The University of British Columbia.</p></div>

      </div>
  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.2</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>
</body>
</html>
